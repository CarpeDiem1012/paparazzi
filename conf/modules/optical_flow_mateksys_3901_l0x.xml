<!DOCTYPE module SYSTEM "module.dtd">

<module name="mateksys_3901_l0x">

  <doc>
    <description>
      Transfers flow X and Y and range data of the Mateksys3901-l0X sensor to the autopilot
      This by the default serial connection not by connecting the debug pins on ther sensor
      The Data is in MSP compatible output. If a MSP stack is availabe in the AP one could use that
      In ths ase we just handle the byres comming from the sensor in MSP compatible handler for this sensor
    </description>
    <configure name="MATEKSYS_3901_L0X_PORT" value="UART1" description="Set to which UART the sensor serial stream pin is connected to"/>
    <configure name="MATEKSYS_3901_L0X_BAUD" value="115200" description="Sets the baudrate of the UART"/>
    <define name="MATEKSYS_3901_L0X_MOTION_THRES" value="120" description="Sets the minimum motion quality to accept the flow measurement"/>
    <define name="MATEKSYS_3901_L0X_DISTANCE_THRES" value="200" description="Sets the minimum distance quality to accept the distance measurement"/>
    <define name="USE_MATEKSYS_3901_L0X_AGL" value="0" description="Send AGL measurements"/>
    <define name="MATEKSYS_3901_L0X_COMPENSATE_ROTATION" value="0" description="Adjust distance from ground by compensating body rotation"/>
  </doc>

  <header>
    <file name="mateksys_3901_l0x.h" dir="modules/optical_flow"/>
  </header>

  <init fun="mateksys3901l0x_init()"/>
  <event fun="mateksys3901l0x_event()"/>

  <makefile>

    <!-- Configure default UART port and baudrate -->
    <configure name="MATEKSYS_3901_L0X_PORT" default="UART3" case="upper|lower"/>
    <configure name="MATEKSYS_3901_L0X_BAUD" default="B115200"/>

    <!-- Enable UART and set baudrate -->
    <define name="USE_$(MATEKSYS_3901_L0X_PORT_UPPER)"/>
    <!--<define name="USE_$(MATEKSYS_3901_L0X_PORT)_TX" value="FALSE"/>-->
    <define name="$(MATEKSYS_3901_L0X_PORT_UPPER)_BAUD" value="$(MATEKSYS_3901_L0X_BAUD)"/>
    <define name="MATEKSYS_3901_L0X_PORT" value="$(MATEKSYS_3901_L0X_PORT_LOWER)"/>

    <define name="MATEKSYS_3901_L0X_MOTION_THRES" value="120"/>
    <define name="MATEKSYS_3901_L0X_DISTANCE_THRES" value="200"/>
    <define name="USE_MATEKSYS_3901_L0X_AGL" value="0"/>
    <define name="MATEKSYS_3901_L0X_COMPENSATE_ROTATION" value="0"/>

    <file name="mateksys_3901_l0x.c" dir="modules/optical_flow"/>

  </makefile>

  <makefile target="nps|sim">
    <define name="USE_SONAR" value="1"/>  <!-- in NPS use a virtual sonar to simulate lidar measurements -->
  </makefile>

</module>
